<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a73e8">
    <title>ç‰›è½‰é–€ï¼šæ™‚ç©ºå°èˆªå„€ (æ¥µç°¡ç‰ˆ)</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIuWIm+i9iee6gOaZgum6uuiwsOatueitpOakrCIsCiAgInNob3J0X25hbWUiIjogIuWIm+i9iee6gCIsCiAgInN0YXJ0X3VybCI6ICIuIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjZjRmN2Y5IiwKICAidGhlbWVfY29sb3IiOiAiIzFhNzNlOCIKfQ==">

    <style>
        :root {
            --primary: #1a73e8;
            --primary-hover: #1557b0;
            --bg: #f4f7f9;
            --card: #ffffff;
            --up-red: #d32f2f;
            --down-green: #388e3c;
            --warning: #f9ab00;
            --border: #dadce0;
            --text-main: #202124;
            --text-sub: #5f6368;
            --harmony-gold: #ffd700;
            --gate-blue: #0288d1;
            --puzzle-purple: #7b1fa2;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); padding: 10px; color: var(--text-main); margin: 0; }

        .container { width: 100%; max-width: 1850px; margin: 0 auto; background: var(--card); padding: 15px; border-radius: 12px; box-shadow: 0 4px 30px rgba(0,0,0,0.1); }
        
        header { text-align: center; margin-bottom: 20px; border-bottom: 3px solid var(--primary); padding-bottom: 10px; }
        h1 { color: var(--primary); margin: 0; font-size: clamp(1.2rem, 4vw, 1.8rem); }
        .description { color: var(--text-sub); font-size: 0.85rem; margin-top: 5px; font-weight: 500; }

        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 12px; margin-bottom: 20px; }
        .meter-card { background: #fff; border: 1px solid var(--border); border-radius: 10px; padding: 12px; text-align: center; display: flex; flex-direction: column; justify-content: center; min-height: 100px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .meter-title { font-size: 0.8rem; font-weight: bold; color: var(--text-sub); margin-bottom: 6px; border-bottom: 1px solid #f1f3f4; padding-bottom: 4px; }
        .meter-value { font-size: 1.3rem; font-weight: 900; line-height: 1.2; }
        .trend-up { color: var(--up-red); }
        .trend-down { color: var(--down-green); }

        .config-panel { background: #ffffff; padding: 12px; border-radius: 10px; margin-bottom: 20px; border: 1px solid var(--border); }
        .level-row { display: grid; grid-template-columns: 50px 1fr 1fr 1fr 1fr; gap: 8px; align-items: center; padding: 8px 0; border-bottom: 1px solid #f1f3f4; }
        .level-label { font-weight: 800; font-size: 13px; color: var(--primary); text-align: center; }
        
        @media (max-width: 850px) {
            .level-row { grid-template-columns: 1fr 1fr; }
            .level-label { grid-column: span 2; background: #e8f0fe; padding: 4px; border-radius: 4px; }
        }

        .input-item { display: flex; flex-direction: column; }
        .input-item label { font-size: 10px; color: #777; margin-bottom: 2px; text-align: center; font-weight: bold; }
        select, input { padding: 6px; border-radius: 6px; border: 1px solid var(--border); font-size: 12px; text-align: center; background: #fdfdfd; width: 100%; }

        .actions { display: flex; gap: 10px; justify-content: center; margin-top: 15px; flex-wrap: wrap; }
        .btn { padding: 12px 40px; border-radius: 25px; font-weight: bold; cursor: pointer; border: none; font-size: 15px; background: var(--primary); color: white; box-shadow: 0 4px 10px rgba(26,115,232,0.3); }

        .result-box { border: 1px solid var(--border); border-radius: 10px; overflow: hidden; background: #fff; }
        .scroll-area { max-height: 50vh; overflow: auto; position: relative; }
        table { width: 100%; border-collapse: separate; border-spacing: 0; font-size: 11px; min-width: 1400px; }
        thead th { position: sticky; top: 0; background: #f8f9fa; z-index: 20; padding: 12px 4px; border-bottom: 2px solid var(--primary); font-weight: 800; }
        
        td:first-child, th:first-child { position: sticky; left: 0; background: #f8f9fa; z-index: 10; border-right: 2px solid var(--border); font-weight: 800; }
        thead th:first-child { z-index: 25; }

        td { padding: 10px 4px; text-align: center; border-bottom: 1px solid #f1f3f4; }
        
        /* 1, 3, B ç´…è‰² | 2, A, C ç¶ è‰² */
        .tag-cell { font-weight: 800; border-radius: 4px; padding: 4px 8px; display: inline-block; min-width: 28px; }
        .tag-up { color: #b71c1c; background: #ffebee; border: 1px solid #ef9a9a; } 
        .tag-down { color: #1b5e20; background: #e8f5e9; border: 1px solid #a5d6a7; }

        .analysis-col { text-align: left; padding-left: 15px; min-width: 500px; line-height: 1.6; }

        /* èƒ½é‡ç­‰ç´š - é¡è‰²å®šç¾© (ç´…æ¼²ç¶ è·Œ) */
        .level-badge { font-weight: 900; padding: 2px 8px; border-radius: 4px; font-size: 11px; display: inline-block; margin-bottom: 3px; min-width: 90px; text-align: center; background: transparent; border: 1px solid currentColor; }
        .p-1 { color: #ff0000; border-color: #ff0000; box-shadow: 0 0 3px rgba(255,0,0,0.2); } /* æ¥µå¤šï¼šç´…è‰² */
        .p-2 { color: var(--up-red); } /* å¼·å¤šï¼šç´…è‰² */
        .p-3 { color: var(--primary); } /* å¤šç©ºé—œéµï¼šè—è‰² */
        .p-4 { color: var(--down-green); } /* ç©ºèª˜å¤šï¼šç¶ è‰² */
        .p-5 { color: var(--down-green); font-weight: 900; } /* ç©ºé ­ï¼šç¶ è‰² */

        /* é–€æ§ç‹€æ…‹æ¨™ç±¤é¡è‰² (ç´…è‰²=ç™¼å‹•/è²·é»/èª˜å¤š | ç¶ è‰²=æ’¤é€€) */
        .gate-status-tag { font-size: 10px; font-weight: 800; padding: 2px 6px; border-radius: 4px; display: block; margin-bottom: 2px; text-transform: uppercase; border: 1px solid transparent; }
        .gs-open { color: #ff0000; border-color: #ff0000; } /* é–‹é–€ã€æ¸¬é–€ï¼šæ”¹ç‚ºç´…è‰² */
        .gs-close { color: var(--down-green); border-color: var(--down-green); } /* é—œé–€æ’¤é€€ï¼šæ”¹ç‚ºç¶ è‰² */
        .gs-alert { color: #ff0000; border-color: #ff0000; } /* Båå½ˆæ‰¾ç©ºé»ï¼šç´…è‰² */

        .power-text { font-size: 10px; font-weight: bold; color: #777; margin-top: 4px; }

        .golden-puzzle { background: #fffdf0 !important; border-left: 6px solid var(--harmony-gold); } 
        .critical-kick { background: #fdf2ff !important; border-left: 5px solid var(--puzzle-purple); } 

        .footer-notes { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; padding: 20px; background: #ffffff; border: 1px solid var(--border); border-radius: 12px; margin-top: 20px; }
        .note-card h3 { color: var(--primary); font-size: 1rem; margin-top: 0; border-left: 4px solid var(--primary); padding-left: 10px; margin-bottom: 10px; }
        .note-card p, .note-card li { font-size: 0.8rem; color: #444; line-height: 1.6; }
        .note-card ul { padding-left: 15px; }
        .note-card b { font-weight: 700; }
        .note-card .red-text { color: #ff0000; }
        .note-card .green-text { color: var(--down-green); }
        .time-box { font-size: 9px; color: #999; display: block; margin-top: 2px; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ç‰›è½‰é–€ï¼šæ³¢å‹•ãƒ»æ‹¼åœ–ãƒ»æ™‚ç©ºå°èˆªå„€</h1>
        <div class="description">å¤šé€±æœŸå…±æŒ¯æ‹¼åœ– | å¤šé›™æ³¢å‹•çµæ§‹ | ç­‰å¾…æ”¶ç›¤ç¢ºèª</div>
        <div class="description">ç¨‹å¼æ’°å¯«ï¼šå…­ç”²è±†å­</div>
        <div class="description">âš ï¸ æ³¨æ„ï¼šå€‹äººäº¤æ˜“å¿ƒå¾—æ•´ç†ï¼Œä¸æ§‹æˆæŠ•è³‡å»ºè­°ï¼›ç‰›è»é–‹é–€æ•™å­¸è«‹è‡ªè¡Œåˆ°<a href="https://www.skool.com/niujun-open-the-door/about?ref=35d3add8e5c64bb58850c92c283d1ba4">SKOOLæŠ€è¡“åŸå‰µè€…</a>å­¸ç¿’</div>
    </header>

    <div class="dashboard">
        <div class="meter-card">
            <div class="meter-title">ç•¶å‰å¤šç©ºè©•åˆ† (Trend)</div>
            <div id="trendMeter" class="meter-value">ç­‰å¾…æ¨æ¼”...</div>
        </div>
        <div class="meter-card">
            <div class="meter-title">æœªä¾†æ¼”åŒ–é è¨€ (Scenario)</div>
            <div id="scenarioText" style="font-size: 0.85rem; font-weight: 600;">è«‹è¼¸å…¥åƒæ•¸å¾Œé»æ“Šæ¨æ¼”</div>
        </div>
        <div class="meter-card">
            <div class="meter-title">çµ•å°é˜²å®ˆåŸºæº– (Risk Control)</div>
            <div id="defensePoint" class="meter-value" style="color: var(--puzzle-purple); font-size: 1.1rem;">é¸æ“‡å±¤ç´šå¾Œæ¨™ç¤º</div>
        </div>
    </div>

    <div class="config-panel" id="inputPanel">
        <!-- JS å‹•æ…‹ç”Ÿæˆ -->
    </div>

    <div class="actions">
        <div class="input-item" style="min-width:180px;">
            <label>é¸æ“‡å°èˆªåŸºæº–å±¤ç´š</label>
            <select id="refLevel">
                <option value="0">æœˆç·šåŸºæº–</option><option value="1">é€±ç·šåŸºæº–</option><option value="2">æ—¥ç·šåŸºæº–</option>
                <option value="3" selected>4H åŸºæº–</option>
                <option value="4">60m åŸºæº–</option><option value="5">15m åŸºæº–</option><option value="6">5m åŸºæº–</option><option value="7">1m åŸºæº–</option>
            </select>
        </div>
        <div class="input-item" style="min-width:100px;">
            <label>é æ¼”æ­¥æ•¸</label>
            <input type="number" id="stepCount" value="60" min="1">
        </div>
        <button class="btn" onclick="runSystemAnalysis()">é–‹å§‹å¤šé€±æœŸçŸ©é™£æ¨æ¼”</button>
    </div>

    <div class="result-box">
        <div class="scroll-area">
            <table id="mainTable">
                <thead>
                    <tr>
                        <th style="width: 85px;">æ­¥æ•¸ / çª—å£</th>
                        <th>æœˆ</th><th>é€±</th><th>æ—¥</th><th>4H</th><th>60m</th><th>15m</th><th>5m</th><th>1m</th>
                        <th style="width: 190px;">èƒ½é‡ãƒ»ç‹€æ…‹ / é–€æ§</th>
                        <th class="analysis-col">ç‰›è½‰é–€å¯¦æˆ°è§£æ (æ”¶ç›¤ç¢ºèªç‚ºæº–)</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <div class="footer-notes">
        <div class="note-card">
            <h3>âš¡ èƒ½é‡ç­‰ç´šèªªæ˜</h3>
            <ul>
                <li><b class="red-text">1. æ¥µå¤š</b>ï¼šå…¨é€±æœŸå‘ä¸Šå…±æŒ¯ï¼Œèƒ½é‡çˆ†ç™¼ã€‚</li>
                <li><b class="red-text">2. å¼·å¤š</b>ï¼šæ­£å¼¦ç›¸ä½ (1, 3, B) ä¸»å°ï¼Œå›æ¸¬è²·é»ã€‚</li>
                <li><b style="color: var(--primary);">3. å¤šç©ºé—œéµ</b>ï¼šè‡¨ç•Œé»ï¼Œè§€å¯Ÿå°é½’è¼ªå¼•å‹•ã€‚</li>
                <li><b class="green-text">4. ç©ºèª˜å¤š</b>ï¼šBæ®µåå½ˆï¼Œå±¬æ–¼é¤˜å¼¦æ³¢ä¿®æ­£ï¼Œæº–å‚™æ”¾ç©ºã€‚</li>
                <li><b class="green-text">5. ç©ºé ­</b>ï¼šé¤˜å¼¦ç›¸ä½ (2, A, C) ä¸»å°ï¼Œé‡åŠ›åŠ é€Ÿã€‚</li>
            </ul>
        </div>
        <div class="note-card">
            <h3>ğŸšª é–€æ§æ©Ÿç†èªªæ˜</h3>
            <ul>
                <li><b class="red-text">ğŸ”“ é–‹é–€ç™¼å‹•</b>ï¼šåƒ¹æ ¼ç«™ä¸Š W é–€æˆ–è·Œç ´ M é–€ï¼Œç©ºé–“é–‹å•Ÿã€‚</li>
                <li><b class="red-text">ğŸ”„ æ¸¬é–€è²·é»</b>ï¼šæ¨™ç±¤ 2 å›æ¸¬ä¸ç ´é–€ï¼Œæ˜¯ç‰›è½‰é–€æœ€ç²¾ç¢ºè²·é»ã€‚</li>
                <li><b class="red-text">âš ï¸ Båå½ˆæ‰¾ç©ºé»</b>ï¼šB æ®µåå½ˆå—é˜»æ–¼é–€ï¼Œæ˜¯èª˜å¤šæ‰¾ç©ºæ©Ÿæœƒã€‚</li>
                <li><b class="green-text">ğŸ”’ é—œé–€æ’¤é€€</b>ï¼šåƒ¹æ ¼ç¸®å›é–€å…§ï¼Œä»£è¡¨æ³¢å‹•çµæŸï¼Œæ‡‰ç«‹å³é›¢å ´ã€‚</li>
            </ul>
        </div>
        <div class="note-card">
            <h3>ğŸ·ï¸ æ¨™ç±¤å±¬æ€§ (ç´…æ¼²ç¶ è·Œ)</h3>
            <ul>
                <li><b class="red-text">1, 3, B</b>ï¼šæ­£å¼¦ç›¸ä½ã€‚ä»£è¡¨å‘ä¸Šç™¼æ•£ã€å›å‡æˆ–åå½ˆèƒ½é‡ã€‚</li>
                <li><b class="green-text">2, A, C</b>ï¼šé¤˜å¼¦ç›¸ä½ã€‚ä»£è¡¨å‘ä¸‹ä¿®æ­£ã€åˆè·Œæˆ–ä¸»è·Œé‡åŠ›ã€‚</li>
                <li><b>æ”¶ç›¤ç¢ºèª</b>ï¼šæ‰€æœ‰åˆ¤æ–·å¿…é ˆä»¥<b>è©²æ™‚æ¡†æ”¶ç›¤åƒ¹</b>ç‚ºæº–ã€‚</li>
            </ul>
        </div>
        <div class="note-card">
            <h3>ğŸ“ˆ å°èˆªå±¤ç´šå®šä½</h3>
            <ul>
                <li><b>æœˆ/é€±/æ—¥</b>ï¼šå®è§€é‡åŠ›ï¼Œå®šç¾©æ™‚ä»£ä¹‹é–€ã€‚</li>
                <li><b>4H/60m</b>ï¼šæ³¢æ®µæ¨™ç«¿ï¼Œåˆ¤å®šç•¶æ—¥å¼·å¼±ã€‚</li>
                <li><b>15m/5m/1m</b>ï¼šé€²å ´æ¿æ©Ÿï¼Œæ•æ‰å¼•å‹•ç¬é–“ã€‚</li>
            </ul>
        </div>
    </div>
</div>

<script>
    const timeframes = [
        { id: 'M', name: 'æœˆ', weight: 25, ratio: 43200 },
        { id: 'W', name: 'é€±', weight: 18, ratio: 10080 },
        { id: 'D', name: 'æ—¥', weight: 14, ratio: 1440 },
        { id: '4H', name: '4H', weight: 12, ratio: 240 },
        { id: '60m', name: '60m', weight: 10, ratio: 60 },
        { id: '15m', name: '15m', weight: 8, ratio: 15 },
        { id: '5m', name: '5m', weight: 8, ratio: 5 },
        { id: '1m', name: '1m', weight: 5, ratio: 1 }
    ];

    const levelNames = timeframes.map(tf => tf.name);
    const labels = ['1', '2', '3', 'A', 'B', 'C'];
    const labelMap = {'1':0, '2':1, '3':2, 'A':3, 'B':4, 'C':5};

    function initUI() {
        const panel = document.getElementById('inputPanel');
        panel.innerHTML = ''; 
        timeframes.forEach(tf => {
            const row = document.createElement('div');
            row.className = 'level-row';
            row.innerHTML = `
                <div class="level-label">${tf.name}</div>
                <div class="input-item">
                    <label>æ³¢å‹•æ¨™ç±¤</label>
                    <select id="wave_${tf.id}">
                        <option value="1">1 - èµ·æ¼²</option><option value="2">2 - å›æ¸¬</option>
                        <option value="3">3 - ä¸»å‡</option><option value="A">A - åˆè·Œ</option>
                        <option value="B">B - åå½ˆ</option><option value="C" selected>C - ä¸»è·Œ</option>
                    </select>
                </div>
                <div class="input-item">
                    <label>7å­—è¨£</label>
                    <select id="mantra_${tf.id}">
                        <option value="UP">UP (ç´…ç­‰é»‘)</option><option value="DOWN" selected>DOWN (é»‘ç­‰ç´…)</option>
                    </select>
                </div>
                <div class="input-item">
                    <label>é–€å±¬æ€§</label>
                    <select id="gateType_${tf.id}">
                        <option value="NONE">ç„¡é–€</option><option value="W_GATE">W é–€(åº•)</option><option value="M_GATE">M é–€(é ­)</option>
                    </select>
                </div>
                <div class="input-item">
                    <label>é–€é–‹é—œ</label>
                    <select id="gateStatus_${tf.id}">
                        <option value="FORMING">å½¢æˆä¸­</option><option value="OPEN">å·²é–‹å•Ÿ</option><option value="CLOSED">å·²é—œé–‰</option>
                    </select>
                </div>
            `;
            panel.appendChild(row);
        });
    }

    function runSystemAnalysis() {
        const steps = parseInt(document.getElementById('stepCount').value) || 60;
        const refIdx = parseInt(document.getElementById('refLevel').value);
        const tbody = document.querySelector('#mainTable tbody');
        tbody.innerHTML = '';

        let matrix = timeframes.map(tf => {
            return {
                id: tf.id, name: tf.name, ratio: tf.ratio, weight: tf.weight,
                wave: document.getElementById(`wave_${tf.id}`).value,
                mantra: document.getElementById(`mantra_${tf.id}`).value, 
                gateType: document.getElementById(`gateType_${tf.id}`).value, 
                gateStatus: document.getElementById(`gateStatus_${tf.id}`).value
            };
        });

        let currentVector = 0;
        matrix.forEach(m => {
            let v = [0, 2, 4].includes(labelMap[m.wave]) ? 1 : -1;
            if (m.wave === 'B' && m.mantra === 'DOWN') v = -1;
            currentVector += v * m.weight;
        });

        const trendMeter = document.getElementById('trendMeter');
        if (currentVector > 20) { trendMeter.innerHTML = "å¼·çƒˆçœ‹å¤š ğŸš€"; trendMeter.className = "meter-value trend-up"; }
        else if (currentVector < -20) { trendMeter.innerHTML = "å¼·çƒˆçœ‹ç©º ğŸ“‰"; trendMeter.className = "meter-value trend-down"; }
        else { trendMeter.innerHTML = "ä¸­æ€§éœ‡ç›ª âš–ï¸"; trendMeter.className = "meter-value"; }

        const defensePoint = document.getElementById('defensePoint');
        const refM = matrix[refIdx];
        const gName = refM.gateType==='W_GATE'?'Wé–€(åº•)':(refM.gateType==='M_GATE'?'Mé–€(é ­)':'å°šæœªå®šé–€');
        defensePoint.innerHTML = `<span style="color:var(--primary)">${refM.name}ç´š</span> ${gName}<br><small style="font-size:9px;color:#999">æ”¶ç›¤ç¢ºèªæœ‰æ•ˆ</small>`;

        const scenarioText = document.getElementById('scenarioText');
        const isMicroOpen = labelMap[matrix[7].wave] === 0 || labelMap[matrix[7].wave] === 2;
        if (matrix[0].wave==='2' && matrix[1].wave==='C' && (matrix[2].wave==='1'||matrix[2].wave==='2')) {
            scenarioText.innerHTML = "âœ¨ <span style='color:var(--up-red)'>é»ƒé‡‘æ©Ÿæœƒ</span>ï¼šå¤§é€±æœŸä¼‘æ¯ï¼Œå°é€±æœŸé»ç«ã€‚";
        } else if (isMicroOpen && currentVector < 0) {
            scenarioText.innerHTML = "âš™ï¸ <span style='color:var(--gate-blue)'>å¼•å‹•è§€å¯Ÿ</span>ï¼š1m/5m æ­£è©¦åœ–æ¨é–‹ " + refM.name + " ç´šå¤§é–€ã€‚";
        } else {
            scenarioText.innerHTML = "âš–ï¸ çµæ§‹è“„å‹¢ä¸­ï¼šè§€å¯Ÿèƒ½é‡å‚³å¯¼èˆ‡é–€æ§åˆ‡æ›ã€‚";
        }

        for (let s = 1; s <= steps; s++) {
            let rowTags = [];
            let totalPower = 0;
            let criticalKick = false;
            let windowCounts = [];

            matrix.forEach((m, i) => {
                let startIdx = labelMap[m.wave];
                let curIdx, nextIdx;
                if (m.gateType === 'W_GATE' && m.gateStatus === 'OPEN') {
                    const loop = [0, 1, 2, 1, 2]; 
                    curIdx = loop[Math.floor(s / m.ratio) % loop.length];
                    nextIdx = loop[Math.floor((s+1) / m.ratio) % loop.length];
                } else if (m.gateType === 'M_GATE' && m.gateStatus === 'CLOSED') {
                    const loop = [3, 4, 5, 4, 5]; 
                    curIdx = loop[Math.floor(s / m.ratio) % loop.length];
                    nextIdx = loop[Math.floor((s+1) / m.ratio) % loop.length];
                } else {
                    curIdx = (startIdx + Math.floor(s / m.ratio)) % 6;
                    nextIdx = (startIdx + Math.floor((s+1) / m.ratio)) % 6;
                }
                rowTags.push(curIdx);
                if (curIdx !== nextIdx) criticalKick = true;
                if ([0, 2, 4].includes(curIdx)) totalPower += m.weight;
                windowCounts.push(s % m.ratio);
            });

            const pLevel = getPowerLevel(totalPower);
            const gStatus = getGateStatus(rowTags[refIdx]);

            const tr = document.createElement('tr');
            if (rowTags[0] === 1 && rowTags[1] === 5 && (rowTags[2] === 0 || rowTags[2] === 1)) tr.className = "golden-puzzle";
            else if (criticalKick) tr.className = "critical-kick";

            let html = `<td><b>Step ${s}</b><span class="time-box">${windowCounts[7]}m</span></td>`;
            rowTags.forEach(v => {
                const isUp = [0, 2, 4].includes(v); 
                html += `<td><span class="tag-cell ${isUp ? 'tag-up' : 'tag-down'}">${labels[v]}</span></td>`;
            });
            
            html += `<td>
                <span class="gate-status-tag ${gStatus.cls}">${gStatus.txt}</span>
                <span class="level-badge p-${pLevel.id}">${pLevel.name}</span>
                <div class="power-text">å…±æŒ¯èƒ½é‡: ${totalPower}%</div>
            </td>`;

            let analysis = `â¡ è§€å¯Ÿ 1m ç´šå¼•å‹•æ˜¯å¦èƒ½æ¨é–‹ ${levelNames[refIdx]} ç´šå¤§é–€ã€‚`;
            if (rowTags[refIdx] === 1 && totalPower >= 70) analysis = `â¡ <b>æ¸¬é–€è²·é»</b>ï¼š${levelNames[refIdx]}ç´šå›æ¸¬ï¼Œæ”¶ç›¤ä¸ç ´å³è²·ã€‚`;
            else if (rowTags[refIdx] === 4) analysis = `âš ï¸ <b>èª˜å¤šé™·é˜±</b>ï¼šBåå½ˆå—å£“æ–¼é–€ï¼Œæº–å‚™åŸ·è¡Œ B é»æ”¾ç©ºã€‚`;
            else if (criticalKick) analysis = `ğŸ”¥ <b>è‡¨é–€ä¸€è…³</b>ï¼šæ€§è³ªå³å°‡åˆ‡æ›ï¼Œ<b>è«‹ç­‰å¾…æ”¶ç›¤ç¢ºèªï¼</b>`;

            html += `<td class="analysis-col">${analysis}</td>`;
            tr.innerHTML = html;
            tbody.appendChild(tr);
        }
    }

    function getPowerLevel(p) {
        if (p >= 85) return {id:1, name:"1. æ¥µå¤š"};
        if (p >= 70) return {id:2, name:"2. å¼·å¤š"};
        if (p >= 50) return {id:3, name:"3. å¤šç©ºé—œéµ"};
        if (p >= 30) return {id:4, name:"4. ç©ºèª˜å¤š"};
        return {id:5, name:"5. ç©ºé ­"};
    }

    function getGateStatus(tag) {
        if (tag === 0 || tag === 2) return {txt:"ğŸ”“ é–‹é–€ç™¼å‹•", cls:"gs-open"};
        if (tag === 1) return {txt:"ğŸ”„ æ¸¬é–€è²·é»", cls:"gs-open"};
        if (tag === 4) return {txt:"âš ï¸ Båå½ˆæ‰¾ç©ºé»", cls:"gs-alert"};
        return {txt:"ğŸ”’ é—œé–€æ’¤é€€", cls:"gs-close"};
    }

    window.onload = initUI;
</script>

</body>
</html>